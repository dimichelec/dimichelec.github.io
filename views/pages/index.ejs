<!DOCTYPE html>
<html>

<style>
#image_frame {
	border-width: 0;
	position:absolute;
	top:0; left:0;
	height:1200px; width:1600px;
	background-image: url('assets/images/rotator-frame.png');
	z-index: 999;
}
.odds_frame {
	border-width: 0;
	position:absolute;
	top:40px; left:40px;
	height:1120px; width:1520px;
}
.ads_frame {
	border-width: 0;
	position:absolute;
	top:40px; left:40px;
	height:1120px; width:1520px;
}
</style>

<iframe id='image_frame'></iframe>
<iframe id='odds_0' class='odds_frame'></iframe>
<iframe id='odds_1' class='odds_frame'></iframe>
<iframe id='ads_0'  class='ads_frame'></iframe>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>

// ------------------------------------------------------------------
// Settings Functions

// check for a settings update, if there is one, get new settings
function checkSettings() {
	$.get('/getSettingsHash', function(res) {
		if(res['hash'] != hash) getSettings();
	});
	setTimeout(checkSettings, settings_check_time*1000);
}

// get new settings from server
function getSettings() {
	$.get('/getSettings', function(res) {
		hash = res['hash'];
		settings = res['settings'];
	});
	copySettings();
}

// copy settings from structure to globals
function copySettings() {
	settings_check_time = settings.settings_check_time;	// in seconds 
	odds_rotation_time  = settings.odds_rotation_time;	// in seconds
	odds_rotation       = settings.odds_rotation;
	main_url            = settings.main_url;
	sports              = settings.sports;
}


// ------------------------------------------------------------------
// Odds Boards Functions

// flip precached board to top and start loading next board on back frame
function rotateOdds() {
	if (odds_cache_toggle) {
		odds_1.style.zIndex = 0;
		odds_0.style.zIndex = -1;
		odds_0.src = main_url + sports[odds_rotation[odds_rotation_index]];
	} else {
		odds_0.style.zIndex = 0;
		odds_1.style.zIndex = -1;
		odds_1.src = main_url + sports[odds_rotation[odds_rotation_index]];
	}
	odds_cache_toggle = !odds_cache_toggle;
	incOddsRotation();
	setTimeout(rotateOdds, odds_rotation_time*1000);
}

// increment odds boards counter to next board in rotation
function incOddsRotation() {
	odds_rotation_index++;
	if (odds_rotation_index >= odds_rotation.length) {
		odds_rotation_index = 0;
	}
}


// ------------------------------------------------------------------
// Start of Execution

// process settings
var hash = <%-JSON.stringify(hash)%>
var settings = <%-JSON.stringify(settings)%>

copySettings();

// setup iframe stack
var odds_cache_toggle = true;
var odds_rotation_index = 0;

var odds_0 = document.getElementById('odds_0');
var odds_1 = document.getElementById('odds_1');
var ads_0  = document.getElementById('ads_0');

odds_0.style.zIndex =  0; // middle (just under image_frame)
odds_1.style.zIndex = -1; // back (odds board staging)
ads_0.style.zIndex =  -2; // wayback (advert staging)

// load up first 2 odds boards
odds_0.src = main_url + sports[odds_rotation[odds_rotation_index]];
incOddsRotation();
odds_1.src = main_url + sports[odds_rotation[odds_rotation_index]];
incOddsRotation();

// start rotation and start periodically checking for settings updates
setTimeout(rotateOdds, odds_rotation_time*1000);
setTimeout(checkSettings, settings_check_time*1000);

</script>
</html>
